# Plan 01-01: MFN.se Scraper Implementation

## Goal

Add MFN.se scraping capability to fetch Swedish stock press releases.

## Requirements Covered

- NEWS-01: Detect stock currency
- NEWS-02: Route SEK stocks to MFN.se
- MFN-01: Fetch MFN.se page
- MFN-02: Parse HTML for headlines
- MFN-03: Extract dates
- MFN-04: Extract links

## Implementation

### Step 1: Understand MFN.se URL Structure

MFN.se URLs follow pattern: `https://mfn.se/a/{company-slug}`

Known mappings:
- Clavister → `https://mfn.se/a/clavister`
- Nanexa → `https://mfn.se/a/nanexa`

The slug is typically the lowercase company name.

### Step 2: Modify Workflow Architecture

Current flow:
```
Extract Stocks → Yahoo Search → Process News → Filter New → Discord
```

New flow:
```
Extract Stocks → Check Currency → [Branch]
                                    ├─ SEK → MFN.se Fetch → Parse MFN
                                    └─ Other → Yahoo Search
                                 → Merge Results → Process News → Filter New → Discord
```

### Step 3: Add "Check Currency" Node

After "Extract Unique Stocks", add a Code node that:
- Checks `$json.currency` field
- Returns `{ ...stock, newsSource: currency === 'SEK' ? 'mfn' : 'yahoo' }`

### Step 4: Add "Route by Source" Node

Use n8n's Switch node or IF node to branch:
- If `newsSource === 'mfn'` → MFN.se path
- Else → Yahoo path

### Step 5: Add "Fetch MFN.se" Node

HTTP Request node:
- URL: `https://mfn.se/a/{{ $json.name.toLowerCase().replace(/[^a-z0-9]+/g, '-') }}`
- Method: GET
- Headers: `User-Agent: Mozilla/5.0`
- Response: Full HTML

### Step 6: Add "Parse MFN HTML" Node

Code node that extracts press releases using regex to find:
- Article links from anchor tags
- Headlines from heading tags
- Dates from time tags with datetime attribute

Returns array of news items with: link, title, date, publisher (MFN.se)

### Step 7: Add "Merge News Results" Node

Use n8n's Merge node to combine:
- Output from MFN.se path
- Output from Yahoo path

### Step 8: Update Discord Embed

Modify "Format Discord Message" to handle MFN.se sources:
- Show "MFN.se" as publisher for Swedish stocks
- Keep Yahoo format for others

## Files to Modify

| File | Changes |
|------|---------|
| `portfolio-news-workflow.json` | Add 5 new nodes, modify connections |

## Verification

1. Test with Clavister (SEK) → Should get MFN.se news
2. Test with NVIDIA (USD) → Should get Yahoo news
3. Test workflow end-to-end → Discord alert received

## Rollback

If MFN.se scraping fails, the existing Yahoo-only flow still works. The new nodes can be bypassed by removing the Switch node.

---
*Created: 2026-01-18*
